server {
  listen   8080;
  listen   [::]:8080;

  root /usr/share/nginx/html;

  location = /graphql-hash.json {
    root /usr/share/nginx/html;
    add_header Cache-Control "no-store";
  }

  location / {
    if ( $uri = '/index.html' ) {
      add_header Cache-Control no-store always;
    }
    try_files $uri /index.html;
    expires off;
  }

  location ${REACT_APP_GRAPHQL_CLIENT_URL} {
    proxy_pass http://${REACT_APP_GRAPHQL_SERVER_HOST}:${REACT_APP_GRAPHQL_SERVER_PORT}${REACT_APP_GRAPHQL_SERVER_LOCATION};
  }

  location /env.js {
    add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
    return 200 'window.__env__ = {
        "REACT_APP_GRAPHQL_CLIENT_URL": "${REACT_APP_GRAPHQL_CLIENT_URL}"
    }';
  }
}


